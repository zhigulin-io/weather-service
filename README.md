# Weather Service
***Самый лучший сервис погоды***

## Описание

Данный сервис предназначен для мониторинга погоды в разных городах.
Пользователи могли регистрироваться и авторизоваться.
Результатом этих действий будет возвращенный JWT-токен.
Этот токен можно в дальнейшем использовать, чтобы подписываться на города,
а затем запрашивать погоды из подписок.

## Как запустить

1. Установить PostgreSQL
2. Задать переменные окружения:
   1. __DB_HOST__ - узел с СУБД
   2. __DB_PORT__ - порт СУБД
   3. __DB_NAME__ - имя базы данных
   4. __DB_USER__ - имя пользователя базы данных
   5. __DB_PASS__ - пароль от пользователя базы данных.
3. Добавить пользователя через API
4. Вручную установить роль администратора (role_id = 2) через PSQL или любой другой клиент
5. Пользоваться

## Как пользоваться

Чтобы использовать данный сервис, нужно воспользоваться любым
удобным инструментом для работы с REST'ом. Пример такого инструмента - Postman.

### Общие начальные шаги
1. Зарегистрироваться или залогиниться, чтобы получить в ответ JWT-токен
2. Полученный JWT-токе помещать в заголовки запроса
   1. __KEY__ - Authorized
   2. __VALUE__ - Bearer < token >

### Общедоступное API
- POST /auth/reg - регистрация нового обычного пользователя
  - Вход:
    - username - имя нового пользователя
    - password - пароль нового пользователя
  - Выход:
    - jwt_token - токен для обращения к другим частям приложения
- POST /auth/login - аутентификация нового пользователя
  - Вход:
    - username - имя существующего пользователя
    - password - пароль существующего пользователя
  - Выход:
    - jwt_token - токен для обращения к другим частям приложения

### Обычный пользователь

- GET /cities - получить список городов для под
  - Выход:
    - Массив городов:
      - id - id города
      - name - название города
- GET /subscriptions - получить информацию о погоде в городах по подписке
  - Выход:
    - Массив информации о погоде:
      - cityName - название города
      - temperature - температура в городе
- POST /subscriptions - подписаться на информацию о погоде в городе
  - Вход:
    - Название города (Просто текст, без кавычек, но JSON)
  - Выход
    - Название города, если подписка произошла
    - Ничего, если не произошла

### Администратор

- GET /users - получение списка всех пользователей
  - Выход
    - Массив пользователей:
      - id - id пользователя
      - username - имя пользователя
      - role - роль пользователя
- GET /users/{id} - получение информации о пользователе по ID
  - Параметры пути:
    - id - id пользователя
  - Выход:
    - id - id пользователя
    - username - имя пользователя
    - Массив подписок (строк) с названиями городов
- PUT /users/{id} - обновление информации о пользователе
  - Параметры пути:
    - id - id пользователя
  - Вход:
    - username - новое имя пользователя (можно не задавать)
    - emptySubs - очистить список подписок (можно не задавать) (true/false)
  - Выход:
    - username - новое или старое имя пользователя
    - emptySubs - был ли очищен список подписок
- GET /cities - получить список городов для под
   - Выход:
      - Массив городов:
         - id - id города
         - name - название города
- PUT /cities/{id}
   - Параметры пути:
      - id - id города
   - Вход:
     - name - новое имя города (можно не задавать)
     - subscribable - доступность подписки (можно не задавать) (true/false)
   - Выход:
      - name - новое или старое имя города
      - subscribable - доступна ли подписка
- PUT /cities/{id}/{temperature}
   - Параметры пути:
      - id - id города
      - temperature - новая температура города
   - Выход:
      - Установленная температура в городе (не JSON, а просто Integer)

## Чего сделано

- Методы админа
- Методы пользователя
- Аутентификация через токен (JWT)
- Использована Java 11
- Использован Spring Boot
- Использован PostgreSQL
- Использован Flyway вместо liquibase

## Чего пока еще не сделано

- Нехватает тестов
- Не использована реактивность, потому что не еще не изучил эту тему
- Не проведен рефакторинг кода
- Не сделаны дополнительные методы, которые облегчили ли бы работу с сервисом
- Нет javadoc'и
- Не сделан Docker-образ сервиса
